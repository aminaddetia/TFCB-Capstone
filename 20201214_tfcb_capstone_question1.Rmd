---
title: "TFCB capstone question 1"
author: "Amin Addetia"
date: "12/13/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(tidyverse)
library(ggpubr)

dataset <- read.csv('data/ds_whole.csv', header = T)

save <- dataset

dataset %>%
  mutate(glaucoma=case_when(glaucoma == 0 ~ 'No',
                   glaucoma == 1 ~ 'Yes'), .keep = 'unused') -> dataset

dataset %>% 
  mutate(age_group=case_when(age <= 20 ~ '20 yo and under',
                             age >= 21 & age <= 35 ~ '21-35 yo',
                             age >= 36 & age <= 50 ~ '36-50 yo',
                             age >= 51 & age <= 65 ~ '51-65 yo',
                             age >= 66 & age <= 80 ~ '66-80 yo',
                             age > 80 ~ '80 yo and over')) -> dataset

dataset %>%
  group_by(age_group, glaucoma) %>%
  summarise_all(funs(mean)) -> summary

summary <- subset(summary, select = -c(RL))

save2 <- summary

summary %>%
  rename( 'Age Group'= age_group,
          Glaucoma = glaucoma,
          'Mean Age' = age,
          'Mean ocular pressure' = ocular_pressure,
          'Mean MD' = MD,
          'Mean PSD' = PSD,
          'Mean GHT' = GHT,
          'Mean cornea thickness' = cornea_thickness,
          'Mean RNFL thickness' = RNFL4.mean) -> summary

print(summary)

write.csv(summary, 'idkman.csv', row.names = F, header = T)

MD_plot <- ggplot(dataset, aes(x=age_group, y=MD, fill=factor(glaucoma))) + geom_boxplot() + theme_classic() + xlab('Age Group') + labs(fill='Glaucoma') + theme(axis.text.x = element_text(angle = 90))
 
OP_plot <- ggplot(dataset, aes(x=age_group, y=ocular_pressure, fill=factor(glaucoma))) + geom_boxplot() + theme_classic() + xlab('Age Group') + labs(fill='Glaucoma') + ylab('Ocular Pressure') + theme(axis.text.x = element_text(angle = 90))
 
PSD_plot <- ggplot(dataset, aes(x=age_group, y=PSD, fill=factor(glaucoma))) + geom_boxplot() + theme_classic() + xlab('Age Group') + labs(fill='Glaucoma') + theme(axis.text.x = element_text(angle = 90))
 
GHT_plot <- ggplot(dataset, aes(x=age_group, y=GHT, fill=factor(glaucoma))) + geom_boxplot() + theme_classic() + xlab('Age Group') + labs(fill='Glaucoma') + theme(axis.text.x = element_text(angle = 90))

CT_plot <- ggplot(dataset, aes(x=age_group, y=cornea_thickness, fill=factor(glaucoma))) + geom_boxplot() + theme_classic() + xlab('Age Group') + labs(fill='Glaucoma') + ylab('Cornea Thickness') + theme(axis.text.x = element_text(angle = 90))

RNFL4_plot <- ggplot(dataset, aes(x=age_group, y=RNFL4.mean, fill=factor(glaucoma))) + geom_boxplot() + theme_classic() + xlab('Age Group') + labs(fill='Glaucoma') + ylab('RNFL Mean Thickness') + theme(axis.text.x = element_text(angle = 90))

plots <- ggarrange(MD_plot, OP_plot, PSD_plot, GHT_plot, CT_plot, RNFL4_plot, common.legend = T, legend = 'bottom') + theme(axis.text.x = element_text(angle = 90))

plot(plots)

ggsave('idkman.png', plot = plots)